<div class="p-6 mt-12">
    <div class="fixed w-full top-4 right-4">    
      <nav class="bg-white border-gray-200 dark:bg-gray-900">
        <div class="max-w-screen-xl flex items-center justify-between mx-auto p-4">   
          <div class="hidden w-full md:block md:w-auto" id="navbar-default">
            <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
              <li>
                <a routerLink="/user" routerLinkActive="active-class">User</a>
              </li> 
              <li>
                <a routerLink="/user-compound" routerLinkActive="active-class">User Compound Index</a>
              </li>          
            </ul>
          </div>
          <div class="flex md:order-2">
            <button
              class="bg-red-600 text-gray-200 p-2 rounded hover:bg-red-500 hover:text-gray-100"
              (click)="logout()"
            >
              <i class="fa fa-sign-out" aria-hidden="true"></i> Logout            
            </button>
          </div>
        </div>
      </nav>    
    </div>

  <div class="container mx-auto px-4">
    <div class="overflow-hidden rounded-lg border border-gray-200 shadow-md m-5">
      <div class="bg-gray-50 px-6 border py-4 flex justify-between items-center">
        <h2 class="font-medium text-gray-900">User List</h2>
        <button
          (click)="openModal(null)"
          type="button"
          class="bg-blue-500 text-white py-2 px-4 rounded"
        >
          <i class="fa-solid fa-plus"></i> User
        </button>
      </div>
      <table
        class="w-full border-collapse bg-white text-left text-sm text-gray-500"
      >
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900">
              First Name
            </th>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900">
              Last Name
            </th>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900">Email</th>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900">
              Phone Number
            </th>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900">
              Retention period
            </th>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900">
              Delete request
            </th>
            <th scope="col" class="px-6 py-4 font-medium text-gray-900"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 border-t border-gray-100">
          <tr *ngIf="(users$ | async)?.length === 0">
            <td colspan="5" class="text-center py-4 text-gray-700">
              No records found.
            </td>
          </tr>
          <tr *ngFor="let user of users$ | async" class="hover:bg-gray-50">
            <th class="flex gap-3 px-6 py-4 font-normal text-gray-900">
              <div class="text-sm">
                <div class="font-medium text-gray-700">{{ user.firstName }}</div>
              </div>
            </th>
            <td class="px-6 py-4">{{ user.lastName }}</td>
            <td class="px-6 py-4">{{ user.email }}</td>
            <td class="px-6 py-4">{{ user.mobileNumber }}</td>
            <td class="px-6 py-4">{{ user.remainingDays }}</td>
            <td class="px-6 py-4">
              <button
                (click)="confirmConsentToDelete(user)"
                id="isRequestedToDelete_{{ user.id }}"
                name="isRequestedToDelete_{{ user.id }}"
                [disabled]="user.isRequestedToDelete"
                [ngClass]="{
                  'bg-blue-500 text-white-custom py-2-custom px-4-custom rounded-custom':
                    !user.isRequestedToDelete,
                  'bg-gray-500 disabled text-white py-2 px-4 rounded':
                    user.isRequestedToDelete
                }"
              >
                <i class="fa-solid fa-user-minus"></i> Raise Delete Request
              </button>
            </td>
            <td class="px-6 py-4">
              <div class="flex justify-end gap-4">
                <a href="javascript:void(0)" (click)="openModal(user)">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-6 w-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"
                    />
                  </svg>
                </a>
                <a href="javascript:void(0)" (click)="confirmDelete(user.id)">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-6 w-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                    />
                  </svg>
                </a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Add/Edit User Modal -->
    <div
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
      *ngIf="showModal"
    >
      <div class="modal-overlay" (click)="closeModal()"></div>
      <div class="bg-white rounded-lg shadow-lg p-6 w-1/3">
        <h2 class="text-lg font-bold mb-4 text-center">
          {{ isEditing ? "Edit User" : "Add User" }}
        </h2>
        <form (ngSubmit)="onSubmit()" [formGroup]="userForm">
          <div class="mb-4">
            <label class="block text-md font-bold mb-2" for="firstName"
              >First Name</label
            >
            <input
              id="firstName"
              formControlName="firstName"
              class="border rounded w-full py-2 px-3"
            />
            <div
              *ngIf="
                userForm.get('firstName')?.invalid &&
                userForm.get('firstName')?.touched
              "
              class="text-red-500 text-xs italic"
            >
              First Name is required.
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-md font-bold mb-2" for="lastName"
              >Last Name</label
            >
            <input
              id="lastName"
              formControlName="lastName"
              class="border rounded w-full py-2 px-3"
            />
            <div
              *ngIf="
                userForm.get('lastName')?.invalid &&
                userForm.get('lastName')?.touched
              "
              class="text-red-500 text-xs italic"
            >
              Last Name is required.
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-md font-bold mb-2" for="email">Email</label>
            <input
              id="email"
              formControlName="email"
              type="email"
              class="border rounded w-full py-2 px-3"
            />
            <div
              *ngIf="
                userForm.get('email')?.invalid &&
                userForm.get('email')?.touched
              "
              class="text-red-500 text-xs italic"
            >
              Please enter a valid email.
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-md font-bold mb-2" for="phone"
              >Phone Number</label
            >
            <input
              id="mobileNumber"
              formControlName="mobileNumber"
              class="border rounded w-full py-2 px-3"
            />
            <div
              *ngIf="
                userForm.get('mobileNumber')?.invalid &&
                userForm.get('mobileNumber')?.touched
              "
              class="text-red-500 text-xs italic"
            >
              Phone number is required and should be between 10 to 12 digits.
            </div>
          </div>
          <div class="flex justify-end">
            <button
              type="button"
              (click)="closeModal()"
              class="bg-red-500 text-white py-2 px-4 rounded mr-2"
            >
            <i class="fas fa-window-close"></i>  Close
            </button>
            <button
              type="submit"
              class="bg-blue-500 text-white py-2 px-4 rounded"
            >
              <i class="fas fa-edit" *ngIf="isEditing"></i>
              <i class="fa-solid fa-plus" *ngIf="!isEditing"></i>
              {{ isEditing ? "Update" : "Create" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
  *ngIf="showConfirmModal"
>
  <div class="bg-white rounded-lg shadow-lg p-6 w-1/3">
    <h2 class="text-lg font-bold mb-4">Confirm Deletion</h2>
    <p>Are you sure you want to delete this user?</p>
    <div class="flex justify-end mt-4">
      <button
        type="button"
        (click)="closeConfirmModal()"
        class="bg-red-500 text-white py-2 px-4 rounded mr-2"
      >
      <i class="fas fa-window-close"></i> Close
      </button>
      <button
        type="button"
        (click)="deleteConfirmed()"
        class="bg-blue-500 text-white py-2 px-4 rounded"
      >
        <i class="fa-solid fa-trash"></i>Delete
      </button>
    </div>
  </div>
</div>
<div
  *ngIf="isOpenConfirmation"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div class="bg-white p-6 rounded shadow-lg w-1/3">
    <h2 class="text-2xl font-semibold mb-4">Raise Delete request</h2>
    <p class="mb-4">
      Are you sure you want to raise a request to delete full data of this user?
    </p>
    <div class="flex justify-end mt-4">
    <button
      (click)="closeConsentModal()"
      class="bg-red-500 text-white px-4 py-2 rounded mr-2"
    >
      <i class="fas fa-window-close"></i> Close
    </button>
    <button
      (click)="markForDelete()"
      class="bg-blue-500 text-white py-2 px-4 rounded"
    >
    <i class="fa-solid fa-check"></i> Request
    </button>
  </div>
  </div>
</div>
